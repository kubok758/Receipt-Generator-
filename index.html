<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ß–µ–∫–æ–≤</title>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            display: flex;
            flex-direction: row; /* –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ä—è–¥ */
            padding: 20px;
            gap: 20px;
            align-items: flex-start;
            margin: 0;
            box-sizing: border-box;
        }

        /* –ü–∞–Ω–µ–ª—å –Ω–∞—Å—Ç—Ä–æ–µ–∫ */
        .controls {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            width: 350px;
            flex-shrink: 0;
        }

        h2, h3 { margin-top: 0; color: #333; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 6px; font-weight: 600; font-size: 14px; color: #555; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤ - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–∞—á–∞ */
        input { 
            width: 100%; 
            padding: 12px; 
            box-sizing: border-box; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; /* 16px —á—Ç–æ–±—ã iOS –Ω–µ –∑—É–º–∏–ª */
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus { border-color: #007bff; }

        .items-control { 
            border-top: 2px dashed #eee; 
            padding-top: 20px; 
            margin-top: 20px; 
        }

        /* –ö–Ω–æ–ø–∫–∏ - –±–æ–ª—å—à–∏–µ –∏ —É–¥–æ–±–Ω—ã–µ */
        .btn {
            background-color: #007bff; color: white; border: none; 
            padding: 14px; border-radius: 8px; cursor: pointer; 
            width: 100%; margin-top: 10px; font-size: 16px; font-weight: 600;
            box-shadow: 0 2px 4px rgba(0,123,255,0.2);
            -webkit-tap-highlight-color: transparent;
        }
        .btn:active { transform: scale(0.98); }
        .btn-add { background-color: #28a745; margin-bottom: 15px; box-shadow: 0 2px 4px rgba(40,167,69,0.2); }
        
        /* –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ */
        #itemsList .item-preview {
            background: #f8f9fa; padding: 10px; margin-bottom: 8px; 
            border-radius: 6px; display: flex; justify-content: space-between; 
            align-items: center; font-size: 14px;
        }
        .delete-btn { 
            color: #dc3545; padding: 5px 10px; cursor: pointer; font-weight: bold; font-size: 18px;
        }

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —á–µ–∫–∞ */
        .receipt-wrapper {
            flex-grow: 1;
            display: flex;
            justify-content: center;
            background: #e9ecef; /* –°–µ—Ä—ã–π —Ñ–æ–Ω –ø–æ–¥ —á–µ–∫–æ–º */
            padding: 20px;
            border-radius: 12px;
            overflow: auto; /* –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –µ—Å–ª–∏ –Ω–µ –≤–ª–µ–∑–∞–µ—Ç */
        }

        #receipt {
            width: 380px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞–∫ —É —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–µ–∫–∞ */
            min-width: 380px;
            background-color: #fff;
            font-family: 'VT323', monospace;
            font-size: 20px;
            line-height: 1.1;
            color: #000;
            padding: 15px 15px 30px 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.05);
            /* –≠—Ñ—Ñ–µ–∫—Ç —Ä–≤–∞–Ω–æ–≥–æ –∫—Ä–∞—è —Å–Ω–∏–∑—É (–≤–∏–∑—É–∞–ª—å–Ω–æ) */
            position: relative;
        }

        .center { text-align: center; }
        .right { text-align: right; }
        .left { text-align: left; }
        .bold { font-weight: bold; }
        .divider { white-space: nowrap; overflow: hidden; margin: 6px 0; }
        .item-row { margin-bottom: 6px; }
        .item-math { text-align: right; }

        #qrcode {
            display: flex; justify-content: center; margin-top: 20px;
        }
        #qrcode img { margin: 0 auto; }

        /* --- –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ –ü–û–î –¢–ï–õ–ï–§–û–ù–´ --- */
        @media screen and (max-width: 800px) {
            body {
                flex-direction: column; /* –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ */
                padding: 10px;
                gap: 15px;
            }

            .controls {
                width: 100%; /* –ù–∞ –≤—Å—é —à–∏—Ä–∏–Ω—É */
                padding: 15px;
            }

            .receipt-wrapper {
                width: 100%;
                padding: 10px 0; /* –ú–µ–Ω—å—à–µ –æ—Ç—Å—Ç—É–ø–æ–≤ */
                background: transparent;
                display: block; /* –ß—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª overflow-x */
                overflow-x: auto; /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –¥–ª—è —á–µ–∫–∞ */
                box-sizing: border-box;
            }

            #receipt {
                margin: 0 auto; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º —á–µ–∫ */
            }

            /* –£–ª—É—á—à–∞–µ–º –ø–æ–ª—è –≤–≤–æ–¥–∞ —Ü–µ–Ω—ã –∏ –∫–æ–ª-–≤–∞ */
            .price-qty-row {
                display: flex;
                gap: 10px;
            }
            .price-qty-row input {
                width: 50%;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>

    <div class="controls">
        <h2>üßæ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —á–µ–∫–∞</h2>
        
        <div class="input-group">
            <label>–û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è</label>
            <input type="text" id="orgName" value='–û–û–û "–ú–æ—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è"' oninput="renderReceipt()">
        </div>
        <div class="input-group">
            <label>–ò–ù–ù</label>
            <input type="tel" id="inn" value="0000000000" oninput="renderReceipt()"> </div>
        <div class="input-group">
            <label>–ê–¥—Ä–µ—Å</label>
            <input type="text" id="address" value="–≥. –ì–æ—Ä–æ–¥, —É–ª. –£–ª–∏—Ü–∞, –¥. 1" oninput="renderReceipt()">
        </div>

        <div class="items-control">
            <h3>–¢–æ–≤–∞—Ä—ã</h3>
            <div class="input-group">
                <input type="text" id="newItemName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ (–Ω–∞–ø—Ä. –•–ª–µ–±)">
            </div>
            <div class="input-group price-qty-row">
                <input type="number" id="newItemPrice" placeholder="–¶–µ–Ω–∞" inputmode="decimal">
                <input type="number" id="newItemQty" value="1" placeholder="–ö–æ–ª-–≤–æ" inputmode="numeric">
            </div>
            <button class="btn btn-add" onclick="addItem()">+ –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
            
            <div id="itemsList"></div>
        </div>
        
        <button class="btn" style="background-color: #333; margin-top: 20px;" onclick="downloadReceipt()">üì• –°–∫–∞—á–∞—Ç—å —á–µ–∫ (JPG)</button>
    </div>

    <div class="receipt-wrapper">
        <div id="receipt">
            <div class="center bold" id="r-org">–û–û–û "–ú–æ—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è"</div>
            <div class="center">–ò–ù–ù: <span id="r-inn">0000000000</span></div>
            <div class="center" id="r-address">–≥. –ì–æ—Ä–æ–¥, —É–ª. –£–ª–∏—Ü–∞, –¥. 1</div>
            
            <div class="divider">------------------------------------------</div>
            <div>–î–∞—Ç–∞: <span id="r-date"></span> –í—Ä–µ–º—è: <span id="r-time"></span></div>
            <div class="bold">–¢–û–í–ê–†–ù–´–ô –ß–ï–ö</div>
            <div class="divider">******************************************</div>
            
            <div id="r-items"></div>

            <div class="divider">******************************************</div>
            <div class="right bold" style="font-size: 24px;">–ò–¢–û–ì: <span id="r-total">0.00</span></div>
            <div class="left">–û–ø–ª–∞—Ç–∞: –ë–ï–ó–ù–ê–õ–ò–ß–ù–´–ú–ò</div>
            <div class="divider">------------------------------------------</div>
            <div class="center">–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!</div>
            
            <div id="qrcode"></div>
            <div class="center" style="margin-top: 10px; font-size: 14px;">–§–ü: 3948274921</div>
        </div>
    </div>

    <script>
        let items = [];
        // –ù–∞—á–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä
        items.push({name: "–ö–æ—Ñ–µ –õ–∞—Ç—Ç–µ 0.4", price: 250, qty: 1});
        items.push({name: "–ö—Ä—É–∞—Å—Å–∞–Ω", price: 150, qty: 2});

        function updateTime() {
            const now = new Date();
            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è
            const dateStr = now.toLocaleDateString('ru-RU');
            const timeStr = now.toLocaleTimeString('ru-RU', {hour: '2-digit', minute:'2-digit'});
            document.getElementById('r-date').innerText = dateStr;
            document.getElementById('r-time').innerText = timeStr;
        }

        function addItem() {
            const nameInput = document.getElementById('newItemName');
            const priceInput = document.getElementById('newItemPrice');
            const qtyInput = document.getElementById('newItemQty');

            const name = nameInput.value.trim() || "–¢–æ–≤–∞—Ä";
            const price = parseFloat(priceInput.value) || 0;
            const qty = parseFloat(qtyInput.value) || 1;

            if (price <= 0) {
                alert("–£–∫–∞–∂–∏—Ç–µ —Ü–µ–Ω—É —Ç–æ–≤–∞—Ä–∞!");
                return;
            }

            items.push({name, price, qty});
            
            // –°–±—Ä–æ—Å –ø–æ–ª–µ–π
            nameInput.value = '';
            priceInput.value = '';
            qtyInput.value = '1';
            nameInput.focus(); // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ–∫—É—Å –Ω–∞ –∏–º—è —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–≤–æ–¥–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ
            
            renderReceipt();
        }

        function deleteItem(index) {
            items.splice(index, 1);
            renderReceipt();
        }

        function renderReceipt() {
            document.getElementById('r-org').innerText = document.getElementById('orgName').value;
            document.getElementById('r-inn').innerText = document.getElementById('inn').value;
            document.getElementById('r-address').innerText = document.getElementById('address').value;

            const itemsContainer = document.getElementById('r-items');
            const itemsListControl = document.getElementById('itemsList');
            itemsContainer.innerHTML = '';
            itemsListControl.innerHTML = '';
            
            let totalSum = 0;

            items.forEach((item, index) => {
                const itemTotal = item.price * item.qty;
                totalSum += itemTotal;

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —á–µ–∫–µ
                const itemDiv = document.createElement('div');
                itemDiv.className = 'item-row';
                itemDiv.innerHTML = `
                    <div style="word-break: break-all;">${index + 1}. ${item.name}</div>
                    <div class="item-math">${item.qty} x ${item.price.toFixed(2)} = ${itemTotal.toFixed(2)}</div>
                `;
                itemsContainer.appendChild(itemDiv);

                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —Å–ø–∏—Å–∫–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
                const controlDiv = document.createElement('div');
                controlDiv.className = 'item-preview';
                controlDiv.innerHTML = `
                    <div style="flex-grow:1"><b>${item.name}</b><br><span style="color:#666">${item.qty} —à—Ç. x ${item.price}‚ÇΩ</span></div>
                    <div class="delete-btn" onclick="deleteItem(${index})">‚úï</div>
                `;
                itemsListControl.appendChild(controlDiv);
            });

            document.getElementById('r-total').innerText = totalSum.toFixed(2) + "‚ÇΩ";

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR
            const qrContainer = document.getElementById('qrcode');
            qrContainer.innerHTML = ''; 
            
            const qrText = `–£—Å–ø–µ—à–Ω–∞—è –æ–ø–ª–∞—Ç–∞ ${totalSum.toFixed(2)}‚ÇΩ. –ñ–¥—ë–º –≤–∞—Å —Å–Ω–æ–≤–∞!`;
            
            new QRCode(qrContainer, {
                text: qrText,
                width: 140,
                height: 140,
                colorDark : "#000000",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.L
            });
        }

        function downloadReceipt() {
            const receiptElement = document.getElementById('receipt');
            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –∫ —á–µ–∫—É –ø–µ—Ä–µ–¥ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ–º –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
            receiptElement.scrollIntoView({behavior: "smooth"});

            setTimeout(() => {
                html2canvas(receiptElement, {
                    scale: 3, // –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
                    backgroundColor: "#ffffff",
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'check_' + Date.now() + '.jpg';
                    link.href = canvas.toDataURL('image/jpeg', 0.95);
                    link.click();
                });
            }, 500);
        }

        updateTime();
        renderReceipt();
    </script>
</body>
</html>
